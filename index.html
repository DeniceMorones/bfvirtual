<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Novio Virtual - MEF con Imagenes Estaticas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f0f4f8 0%, #e0e7f0 100%);
            min-height: 100vh;
        }
        .card {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        .input-button {
            transition: transform 0.1s, box-shadow 0.1s;
        }
        .input-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 100, 150, 0.4);
        }
        .input-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 10px rgba(255, 100, 150, 0.2);
        }
        
        /* Clases de borde personalizadas para los estados principales */
        .border-state-0 { border-color: #3b82f6; } /* Normal - Blue */
        .border-state-1 { border-color: #ef4444; } /* Triste - Red */
        .border-state-2 { border-color: #10b981; } /* Feliz - Green */
        .border-state-3 { border-color: #f59e0b; } /* Molesto - Amber */
        .border-state-9 { border-color: #ec4899; } /* Enamorado - Pink */
        .border-state-11 { border-color: #991b1b; } /* Celoso - Dark Red */
        .border-state-15 { border-color: #34d399; } /* Agradecido - Mint */
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-pink': '#ec4899',
                        'secondary-gray': '#6b7280',
                    }
                }
            }
        }
    </script>
</head>
<body class="flex flex-col items-center p-4">

    <div class="w-full max-w-4xl bg-white card rounded-3xl p-6 md:p-10 mt-8">
        <h1 class="text-3xl md:text-4xl font-extrabold text-gray-800 text-center mb-6">
            Mi Novio Virtual (Modo Est谩tico) 
        </h1>
        <p class="text-secondary-gray text-center mb-8">
            Usa tus propias im谩genes. Edita el array `STATES` en el c贸digo JavaScript con tus URLs.
        </p>

        <!-- rea del Novio / Display -->
        <div id="boyfriend-display" class="relative flex flex-col items-center justify-center p-8 mb-10 rounded-2xl bg-gradient-to-br from-pink-50 to-pink-100 border-2 border-state-0 transition-all duration-500 min-h-[300px] shadow-lg">
            
            <!-- Avatar (Imagen est谩tica) -->
            <div id="avatar-container" class="w-40 h-40 mb-4 transition-transform duration-500 flex items-center justify-center">
                <img id="boyfriend-image" src="" alt="Novio Virtual Avatar" class="rounded-full w-full h-full object-cover shadow-lg transition-opacity duration-300">
            </div>

            <!-- Salida/Reacci贸n (Lo que dice o hace) -->
            <p id="output-message" class="text-xl md:text-2xl font-semibold text-gray-700 text-center mb-3 transition-opacity duration-300">
                隆Hola! El modelo 16x16 est谩 listo para usar tus im谩genes.
            </p>

            <!-- Estado Actual -->
            <div class="absolute top-4 right-4 bg-white rounded-full px-4 py-1 shadow-md border-2 border-state-0 transition-colors duration-500">
                <span class="text-sm font-medium text-gray-600">Estado:</span>
                <span id="current-state-text" class="text-sm font-bold text-gray-800 ml-1">0. Normal</span>
            </div>
        </div>
        
        <!-- Botones de Interacci贸n (Entradas) -->
        <h2 class="text-xl font-bold text-gray-700 mb-4 border-b pb-2">Acciones (Entradas)</h2>
        <div id="input-buttons-container" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
            <!-- Los botones se generar谩n con JavaScript -->
        </div>

        <!-- Leyendas de Estados y Salidas (Opcional, para referencia) -->
        <details class="mt-8 p-4 bg-gray-50 rounded-xl">
            <summary class="font-bold text-primary-pink cursor-pointer">Ver Leyendas de Estados, Entradas y Salidas (16x16)</summary>
            <div class="mt-3 text-sm text-gray-600 grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <h3 class="font-bold mb-1">16 Estados (S)</h3>
                    <ul id="state-list" class="list-disc pl-5"></ul>
                </div>
                <div>
                    <h3 class="font-bold mb-1">16 Entradas (I)</h3>
                    <ul id="input-list" class="list-disc pl-5"></ul>
                </div>
                <div>
                    <h3 class="font-bold mb-1">16 Salidas (O)</h3>
                    <ul id="output-list" class="list-disc pl-5"></ul>
                </div>
            </div>
        </details>

    </div>

    <!-- L贸gica de la M谩quina de Estado Finito (MEF) -->
    <script>
        // ===============================================
        // DATOS DE LA MQUINA DE ESTADO FINITO (MEF)
        // ===============================================

        // 1. Definici贸n de Estados (16 en total)
        // ATENCIN: Para usar tus propias im谩genes, reemplaza la URL en la propiedad 'imageUrl'
        const STATES = [
            // Puedes usar URLs de im谩genes subidas a Canvas o externas, o simples placeholders.
            { 
                id: 0, 
                name: "Normal", 
                imageUrl: "img/normal.png" // Reemplaza esta URL
            },
            { 
                id: 1, 
                name: "Triste", 
                imageUrl: "img/triste.png" // Reemplaza esta URL
            },
            { 
                id: 2, 
                name: "Feliz", 
                imageUrl: "img/feliz.png" // Reemplaza esta URL
            },
            { 
                id: 3, 
                name: "Molesto", 
                imageUrl: "img/molesto.png" // Reemplaza esta URL
            },
            { 
                id: 4, 
                name: "Confundido", 
                imageUrl: "img/confundido.png" // Reemplaza esta URL
            },
            { 
                id: 5, 
                name: "Concentrado", 
                imageUrl: "img/concentrado.png" // Reemplaza esta URL
            },
            { 
                id: 6, 
                name: "Asustado", 
                imageUrl: "img/asustado.png" // Reemplaza esta URL
            },
            { 
                id: 7, 
                name: "Indiferente", 
                imageUrl: "img/indiferente.png" // Reemplaza esta URL
            },
            { 
                id: 8, 
                name: "Relajado", 
                imageUrl: "img/relajado.png" // Reemplaza esta URL
            },
            { 
                id: 9, 
                name: "Enamorado", 
                imageUrl: "img/enamorado.png" // Reemplaza esta URL
            },
            { 
                id: 10, 
                name: "Curioso", 
                imageUrl: "img/curioso.png" // Reemplaza esta URL
            },
            { 
                id: 11, 
                name: "Celoso", 
                imageUrl: "img/celoso.png" // Reemplaza esta URL
            },
            { 
                id: 12, 
                name: "Esperanzado", 
                imageUrl: "img/esperanzado.png" // Reemplaza esta URL
            },
            { 
                id: 13, 
                name: "Agotado", 
                imageUrl: "img/agotado.png" // Reemplaza esta URL
            },
            { 
                id: 14, 
                name: "Juguet贸n", 
                imageUrl: "img/jugueton.png" // Reemplaza esta URL
            },
            { 
                id: 15, 
                name: "Agradecido", 
                imageUrl: "img/agradecido.png" // Reemplaza esta URL
            },
        ];

        // 2. Definici贸n de Entradas (16 en total)
        const INPUTS = [
            { id: 0, name: "Consentir" },
            { id: 1, name: "Llamar" },
            { id: 2, name: "Humillar" },
            { id: 3, name: "Abrazar" },
            { id: 4, name: "Amenazar" },
            { id: 5, name: "Golpear" },
            { id: 6, name: "Acariciar" },
            { id: 7, name: "Animar" },
            { id: 8, name: "Coquetear" },
            { id: 9, name: "Conversar" },
            { id: 10, name: "Bromear" },
            { id: 11, name: "Ignorar" },
            { id: 12, name: "Ofrecer Apoyo" },
            { id: 13, name: "Invitar a Salir" },
            { id: 14, name: "Criticar" },
            { id: 15, name: "Elogiar" },
        ];

        // 3. Definici贸n de Salidas (16 en total)
        const OUTPUTS = [
            { id: 0, name: "Sonr铆e" },
            { id: 1, name: "Agradece" },
            { id: 2, name: "Grita" },
            { id: 3, name: "Abraza" },
            { id: 4, name: "Ignora" },
            { id: 5, name: "Escucha" },
            { id: 6, name: "Golpea" },
            { id: 7, name: "Se Sonroja" },
            { id: 8, name: "Llora" },
            { id: 9, name: "Ofende" },
            { id: 10, name: "Pone Atenci贸n" },
            { id: 11, name: "Amenaza" },
            { id: 12, name: "Risita Sarc谩stica" }, 
            { id: 13, name: "Pregunta Curiosa" },
            { id: 14, name: "Suspira Profundamente" },
            { id: 15, name: "Bosteza Ruidosamente" },
        ];
        
        // 4. Funci贸n de Transici贸n f (Pr贸ximo Estado) - Matriz 16x16 (SIN CAMBIOS)
        const f_NEXT_STATE = [
            [2, 0, 3, 3, 2, 3, 7, 2, 9, 0, 14, 7, 8, 9, 3, 2],
            [0, 1, 1, 6, 2, 6, 4, 2, 7, 1, 13, 1, 12, 0, 1, 8],
            [2, 5, 4, 3, 9, 3, 9, 2, 9, 2, 14, 5, 8, 9, 3, 2],
            [8, 7, 3, 3, 0, 3, 7, 8, 7, 7, 11, 3, 0, 3, 3, 0],
            [0, 5, 1, 6, 8, 6, 4, 8, 9, 4, 10, 7, 12, 9, 1, 8],
            [2, 5, 3, 3, 2, 3, 0, 5, 9, 5, 10, 7, 8, 9, 11, 2],
            [0, 5, 1, 6, 8, 6, 8, 8, 4, 5, 13, 6, 12, 1, 1, 8],
            [0, 7, 7, 3, 8, 3, 7, 0, 7, 7, 10, 7, 8, 0, 3, 8],
            [2, 5, 0, 3, 2, 3, 9, 2, 9, 8, 14, 7, 8, 9, 3, 2],
            [9, 9, 5, 1, 4, 9, 6, 2, 9, 5, 14, 11, 9, 9, 3, 2],
            [8, 5, 3, 2, 6, 3, 10, 12, 9, 5, 14, 7, 8, 9, 3, 2],
            [1, 11, 3, 1, 3, 3, 1, 0, 11, 13, 3, 11, 1, 3, 11, 3],
            [9, 0, 1, 9, 6, 6, 9, 12, 9, 10, 14, 7, 12, 9, 3, 2],
            [8, 13, 7, 8, 6, 13, 8, 0, 14, 13, 15, 13, 8, 13, 7, 8],
            [2, 10, 3, 2, 14, 3, 2, 2, 9, 10, 14, 7, 8, 9, 3, 2],
            [2, 0, 4, 2, 4, 4, 2, 2, 9, 8, 14, 7, 8, 9, 3, 2]
        ];

        // 5. Funci贸n de Salida g (Reacci贸n) - Matriz 16x16 (SIN CAMBIOS)
        const g_OUTPUT = [
            [0, 10, 9, 12, 3, 6, 4, 1, 7, 5, 0, 4, 1, 7, 9, 0],
            [4, 4, 4, 11, 3, 11, 4, 0, 4, 4, 8, 4, 10, 14, 9, 1],
            [0, 10, 4, 12, 3, 6, 3, 0, 3, 5, 0, 4, 1, 7, 9, 0],
            [0, 4, 9, 12, 1, 6, 4, 0, 4, 4, 11, 9, 4, 11, 9, 12],
            [0, 10, 4, 2, 3, 8, 4, 1, 3, 5, 13, 4, 10, 7, 9, 1],
            [7, 10, 9, 12, 3, 6, 7, 1, 3, 5, 13, 4, 10, 7, 9, 0],
            [1, 10, 4, 11, 3, 8, 0, 1, 4, 5, 14, 11, 10, 8, 9, 1],
            [0, 4, 4, 12, 0, 6, 3, 1, 4, 4, 15, 4, 10, 14, 9, 12],
            [0, 10, 4, 12, 3, 12, 3, 1, 3, 5, 0, 4, 1, 7, 9, 0],
            [7, 10, 4, 11, 3, 2, 3, 0, 3, 5, 7, 12, 10, 7, 9, 0],
            [1, 13, 9, 3, 11, 6, 0, 13, 7, 5, 13, 4, 10, 7, 9, 1],
            [8, 12, 9, 8, 11, 6, 4, 4, 12, 14, 12, 9, 4, 11, 9, 12],
            [7, 10, 8, 3, 11, 2, 3, 0, 7, 13, 0, 4, 10, 7, 9, 0],
            [1, 15, 4, 3, 11, 6, 1, 0, 12, 15, 15, 4, 10, 14, 9, 1],
            [0, 13, 12, 3, 11, 6, 0, 0, 7, 13, 0, 4, 1, 7, 9, 0],
            [0, 10, 4, 3, 4, 4, 0, 0, 7, 5, 0, 4, 1, 7, 9, 0]
        ];

        // Estado inicial de la MEF
        let currentStateId = 0; // Inicia en 0. Normal

        // Referencias del DOM
        const currentStateText = document.getElementById('current-state-text');
        const outputMessage = document.getElementById('output-message');
        const boyfriendImage = document.getElementById('boyfriend-image');
        const displayDiv = document.getElementById('boyfriend-display');
        const inputButtonsContainer = document.getElementById('input-buttons-container');
        const stateList = document.getElementById('state-list');
        const inputList = document.getElementById('input-list');
        const outputList = document.getElementById('output-list');


        // ===============================================
        // FUNCIONES DE LA APLICACIN
        // ===============================================

        /**
         * Inicializa la interfaz de usuario y genera los botones de entrada.
         */
        function initializeUI() {
            // Generar botones de entrada
            inputButtonsContainer.innerHTML = INPUTS.map(input => `
                <button 
                    onclick="handleInput(${input.id})"
                    class="input-button bg-primary-pink text-white font-semibold py-3 px-4 rounded-xl hover:bg-pink-600 focus:outline-none focus:ring-4 focus:ring-pink-300 transform active:scale-95 transition duration-150 shadow-md whitespace-nowrap"
                    title="${input.name} (Entrada ${input.id})"
                >
                    ${input.name}
                </button>
            `).join('');

            // Llenar leyendas
            stateList.innerHTML = STATES.map(s => `<li>${s.id}. ${s.name}</li>`).join('');
            inputList.innerHTML = INPUTS.map(i => `<li>${i.id}. ${i.name}</li>`).join('');
            outputList.innerHTML = OUTPUTS.map(o => `<li>${o.id}. ${o.name}</li>`).join('');

            // Establecer el estado inicial en la interfaz
            updateUI(currentStateId, "隆Bienvenido! Haz clic en una acci贸n para interactuar.");
        }

        /**
         * Maneja una entrada del usuario, calcula la transici贸n y actualiza el estado.
         * @param {number} inputId - El ID de la entrada (0-15).
         */
        function handleInput(inputId) {
            const S = currentStateId;
            const I = inputId;

            if (S >= f_NEXT_STATE.length || I >= f_NEXT_STATE[S].length) {
                console.error(`Error de transici贸n: Estado ${S} o Entrada ${I} fuera de l铆mites.`);
                outputMessage.textContent = "隆Error! Transici贸n no definida para este estado o entrada.";
                return;
            }

            // 1. Calcular el Pr贸ximo Estado (Funci贸n f)
            const nextStateId = f_NEXT_STATE[S][I];

            // 2. Calcular la Salida (Funci贸n g)
            const outputId = g_OUTPUT[S][I];
            const outputText = OUTPUTS.find(o => o.id === outputId)?.name || "Error de Salida";

            // 3. Actualizar el Estado Global
            currentStateId = nextStateId;

            // 4. Actualizar la Interfaz de Usuario
            updateUI(currentStateId, outputText);
        }

        /**
         * Actualiza los elementos visuales (estado, imagen y mensaje)
         * @param {number} newStateId - El ID del nuevo estado.
         * @param {string} message - El mensaje de la reacci贸n.
         */
        function updateUI(newStateId, message) {
            const newState = STATES.find(s => s.id === newStateId);
            const newStateName = newState?.name || 'Desconocido';
            const imageUrl = newState?.imageUrl || 'https://placehold.co/160x160/000000/ffffff?text=ERROR';
            
            // 1. Actualizar texto del estado y mensaje
            currentStateText.textContent = `${newStateId}. ${newStateName}`;
            outputMessage.textContent = message;
            
            // 2. Aplicar la nueva imagen (directamente, sin carga de IA)
            boyfriendImage.classList.add('animate-pulse-once'); // Simular una peque帽a animaci贸n de reacci贸n
            
            boyfriendImage.onload = () => {
                // Remover animaci贸n despu茅s de que la imagen se ha cargado
                setTimeout(() => {
                    boyfriendImage.classList.remove('animate-pulse-once');
                }, 500);
            };
            
            boyfriendImage.src = imageUrl;
            
            // 3. Actualizar borde de color
            const oldBorderClass = displayDiv.className.match(/border-state-\d+/);
            if (oldBorderClass) {
                displayDiv.classList.remove(oldBorderClass[0]);
            }
            const newBorderClass = `border-state-${newStateId}`;
            // Comprueba si la clase de estilo existe antes de a帽adirla (solo para los estados principales)
            if (document.head.querySelector(`style`).innerHTML.includes(newBorderClass)) {
                displayDiv.classList.add(newBorderClass);
            } else {
                 displayDiv.classList.add('border-primary-pink'); // Fallback color
            }
        }

        // Agregar la animaci贸n CSS para el efecto de reacci贸n
        const style = document.createElement('style');
        style.innerHTML += `
            @keyframes pulse-once {
                0% { transform: scale(1); }
                50% { transform: scale(1.05); }
                100% { transform: scale(1); }
            }
            .animate-pulse-once {
                animation: pulse-once 0.5s ease-in-out;
            }
        `;
        document.head.appendChild(style);


        window.onload = initializeUI;
    </script>

</body>
</html>